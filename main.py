from tkinter import *
from tkinter import filedialog
import os
import joblib
from feature_extraction import feature_extraction
import sklearn

model = joblib.load('/bin/model.sav')

def scanFile():
    filename = filedialog.askopenfilename(initialdir = "/", title = "Select a File", filetypes=[("PDF Files", '*.pdf')])
    label_file_explorer.configure(text="Scanning file: " + filename)
    scan(filename)

def scan(path):
    features = feature_extraction(path)
    features[0].pop()
    result = model.predict(features)
    print(result)
    if result[0] == 'yes':
        def delete():
            try:
                os.remove(path)
                label1.config(text = f'{path} was successfully deleted')
            except:
                label1.config(text = 'Error, Delete Not Successful')
            
        bad= Tk()
        bad.title('Malicious File Alert')
        bad.geometry('300x150')

        label1 = Label(
            bad,
            text='The file you scanned is Malicious!',
            wraplength = 200,
            font = ('Segoe UI', 12, 'bold'),
            bg = 'red',
            fg = 'white'
        )

        button1 = Button(
            bad,
            text = 'Delete',
            command = delete
        )

        button3 = Button(
            bad,
            text = 'Ignore',
            command = exit
        )

        label1.pack()
        button1.pack()
        button3.pack()
        bad.mainloop()

    else:
        good = Tk()
        good.title('Benign File Alert')
        good.geometry('300x100')

        Label(
            good,
            text= 'The file you scanned is Benign!',
            font = ('Segoe UI', 12, 'bold'),
            bg = 'blue',
            fg = 'white'
        ).pack()

        Button(
            good,
            text = 'Exit',
            command = exit
        ).pack()

        good.mainloop()

window = Tk()
window.title('Malicious PDF Scanner')
window.geometry("400x200")
window.config(background = "white")

label_file_explorer = Label(window,
							text = "Your selected file/folder will appear here",
							width = 100, height = 4,
                            wraplength = 300,
							bg = 'white', fg = "blue")

button_scanfile = Button(window,
						text = "Scan PDF File",
						command = scanFile)

label_file_explorer.pack()
button_scanfile.pack()
window.mainloop()